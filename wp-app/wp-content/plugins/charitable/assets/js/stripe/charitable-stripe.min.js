!function(e){var t,r=e("body"),n=function(e){var t=e.get_input("connect_charge_owner");return t.length?t.val():null},i=function(e){var t=e.get_input("connected_account");return t.length?t.val():null},a=function(e){return"direct"===n(e)||"platform"===n(e)&&e.is_recurring_donation()},o=function(e,t){return"direct"===n(e)||t?{stripeAccount:i(e)}:null};r.on("charitable:form:initialize",function(n){"checkout"===CHARITABLE_STRIPE_VARS.mode?new function(){t=Stripe(CHARITABLE_STRIPE_VARS.key),r.on("charitable:form:processed",function(e,r,n){r.success&&"make_donation"===n.get_input("charitable_action").val()&&"stripe"===n.get_payment_method()&&(e.preventDefault(),n.add_pending_process("stripe"),a(n)?new_stripe=Stripe(CHARITABLE_STRIPE_VARS.key,o(n,!0)):new_stripe=t,new_stripe.redirectToCheckout({sessionId:r.session_id}).then(function(e){n.add_error(e.error.message),n.remove_pending_process_by_name("stripe")}))})}:new function(){var n,i,c=(t=Stripe(CHARITABLE_STRIPE_VARS.key)).elements().create("card"),d=e("#charitable_stripe_card_field"),s=e("#charitable_stripe_card_errors"),_=e(".charitable-donation-form [data-input=cc_name]"),p=e(".charitable-donation-form [name=postcode]");c.mount("#charitable_stripe_card_field"),c.on("change",function(e){s.text(e.error?e.error.message:"")}),p.length&&p.on("change",function(e){c.update({value:{postalCode:e.target.value}})}).trigger("change"),n=d.height(),i=(_.innerHeight()-n)/2,d.css({paddingTop:i,paddingRight:_.css("paddingRight"),paddingBottom:i,paddingLeft:_.css("paddingLeft"),border:_.css("border"),borderRadius:_.css("borderRadius"),background:_.css("background")}),r.on("charitable:form:validate",function(e,r){if("make_donation"===r.get_input("charitable_action").val()&&"stripe"===r.get_payment_method()){if(e.preventDefault(),""!==s.text())return r.hasOwnProperty("prevent_scroll_to_top")&&(r.prevent_scroll_to_top=!0),r.add_error(s.text()),void r.hide_processing();if(0===r.errors.length){r.add_pending_process("stripe");var n=r.get_email(),i=r.get_input("phone"),a=(p={},[{field:"city",key:"city"},{field:"country",key:"country"},{field:"address",key:"line1"},{field:"address_2",key:"line2"},{field:"postcode",key:"postal_code"},{field:"state",key:"state"}].forEach(function(e){var t=r.get_input(e.field);t.length&&t.val().length&&(p[e.key]=t.val())}),p),o={billing_details:(d={name:_.val(),email:n,address:a},i.length&&i.val().length&&(d.phone=i.val()),d)};t.createPaymentMethod("card",c,o).then(function(e){e.error?r.hasOwnProperty("prevent_scroll_to_top")?r.prevent_scroll_to_top=!0:r.add_error(e.error.message):r.get_input("stripe_payment_method").val(e.paymentMethod.id),r.remove_pending_process_by_name("stripe")})}var d,p}}),r.on("charitable:form:processed",function(e,r,n){r.success&&(n.is_recurring_donation()&&!r.requires_action||"make_donation"===n.get_input("charitable_action").val()&&"stripe"===n.get_payment_method()&&(e.preventDefault(),0===n.errors.length&&(n.add_pending_process("stripe"),(a(n)?Stripe(CHARITABLE_STRIPE_VARS.key,o(n,!0)):t).handleCardPayment(r.secret).then(function(e){e.error&&n.add_error(e.error.message),n.remove_pending_process_by_name("stripe")}))))})}})}(jQuery);